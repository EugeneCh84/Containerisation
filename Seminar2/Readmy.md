# Контейнеризация (семинары) #

## Урок 2. Механизмы контрольных групп ##

1) запустить контейнер с ubuntu, используя механизм LXC
2) ограничить контейнер 256 Мб ОЗУ и проверить, что ограничение работает
### Задание по желанию .. ###
4) добавить автозапуск контейнеру, перезагрузить ОС и убедиться, что контейнер действительно запустился самостоятельно
5) при создании указать файл, куда записывать логи
6) после перезагрузки проанализировать логи

Для запуска контейнера необходимо выолнить команды:

sudo lxc-start -n "имя_контейнера"
sudo lxc-attach -n "имя_контейнера"

![Screenshot from 2023-06-26 15-46-43.png](Screenshots%2FScreenshot%20from%202023-06-26%2015-46-43.png)

Теперь проверим какое количество памяти выделено контейнеру

![Screenshot from 2023-06-26 15-53-22.png](Screenshots%2FScreenshot%20from%202023-06-26%2015-53-22.png)

С помощью следующей команды узнаем каким значением ограничено выделение памяти

cat /sys/fs/cgroup/memory.max

![Screenshot from 2023-06-26 16-01-05.png](Screenshots%2FScreenshot%20from%202023-06-26%2016-01-05.png)

Видим что ограничения на выделение памяти нет. Исправим это.

Откроем файл конфигурации контейнера

![Screenshot from 2023-06-26 16-04-14.png](Screenshots%2FScreenshot%20from%202023-06-26%2016-04-14.png)

В нем добавим строку 

lxc.cgroup2.memory.max = 256M

![Screenshot from 2023-06-26 16-06-21.png](Screenshots%2FScreenshot%20from%202023-06-26%2016-06-21.png)

Проверяем:

![Screenshot from 2023-06-26 16-15-05.png](Screenshots%2FScreenshot%20from%202023-06-26%2016-15-05.png)

Чтобы контейнер запускался автоматически необходимо в файл конфигурации добавить строку 

lxc.start.auto = 1

![Screenshot from 2023-06-26 16-17-56.png](Screenshots%2FScreenshot%20from%202023-06-26%2016-17-56.png)

После выполнения команды $reboot

![Screenshot from 2023-06-26 16-20-13.png](Screenshots%2FScreenshot%20from%202023-06-26%2016-20-13.png)

Для отлавливания ошибок в работе контейнера можно включить логирование работы.

Добавить в файл конфигурации строки:

lxc.log.level = 0 (цифра означает уровень логирования)

lxc.log.file = /var/lib/lxc/test1/log/lxc1.log   адрес файла для логирования

![Screenshot from 2023-06-26 17-13-03.png](Screenshots%2FScreenshot%20from%202023-06-26%2017-13-03.png)

Ниже скриншот самого файла логирования.

![Screenshot from 2023-06-26 17-14-43.png](Screenshots%2FScreenshot%20from%202023-06-26%2017-14-43.png)